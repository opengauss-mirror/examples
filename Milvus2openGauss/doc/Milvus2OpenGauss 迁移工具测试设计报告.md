# Milvus2OpenGauss 迁移工具测试设计报告

## 1. 引言

### 1.1 项目概述
本测试设计报告针对 Milvus2OpenGauss 迁移工具项目，该项目主要实现将 Milvus 向量数据库中的数据（包括标量、稠密向量、稀疏向量等）迁移到 openGauss 向量数据库，并确保迁移过程的正确性、完整性和性能可接受。

### 1.2 测试目标
- 验证迁移工具的功能正确性
- 确保数据迁移的完整性和一致性
- 评估迁移前后的性能变化
- 验证索引迁移的正确性

## 2. 测试范围

### 2.1 功能测试范围
- **数据生成功能**：验证生成脚本能够按指定字段类型和数量生成测试数据
- **数据迁移功能**：验证迁移脚本能够正确处理各种数据类型迁移
- **索引迁移功能**：验证索引参数和属性的正确迁移
- **数据一致性**：验证迁移前后数据的完整性和准确性

### 2.2 非功能测试范围
- **性能测试**：迁移过程的吞吐量、查询延迟等性能指标
- **稳定性测试**：大规模数据迁移的稳定性和错误处理能力
- **兼容性测试**：不同版本数据库的兼容性

## 3. 测试环境

### 3.1 硬件环境
- CPU：8核心以上
- 内存：16GB以上
- 存储：100GB以上可用空间
- 网络：千兆以太网

### 3.2 软件环境
- **数据库**：
  - Milvus 2.3+
  - openGauss 7.0.0-RC1+（启用DataVec向量引擎）
- **编程语言**：Python 3.8+
- **依赖库**：psycopg2、pymilvus == 2.4.9、numpy等

## 4. 测试策略

### 4.1 单元测试
针对各个功能模块进行独立测试：
- 数据类型映射功能
- 稀疏向量转换算法
- 分块导出功能
- 索引迁移逻辑

### 4.2 集成测试
测试模块间的协作：
- 完整迁移流程测试
- 配置文件的正确解析
- 日志系统的完整性

### 4.3 系统测试
端到端测试迁移工具：
- 不同规模数据的迁移测试
- 异常情况处理测试
- 性能基准测试

## 5. 测试用例设计

### 5.1 数据生成功能测试

| 测试用例ID | 测试场景         | 预期结果                        |
| ---------- | ---------------- | ------------------------------- |
| DG-001     | 指定标量字段生成 | 成功生成指定数量的标量数据      |
| DG-002     | 指定向量字段生成 | 成功生成指定维度的向量数据      |
| DG-003     | 指定稀疏向量生成 | 成功生成稀疏向量数据            |
| DG-004     | 创建指定索引     | 成功创建指定索引                |
| DG-005     | 分批数据注入     | 数据分批成功注入，不超出RPC限制 |

### 5.2 数据迁移功能测试

| 测试用例ID | 测试场景                | 预期结果                   |
| ---------- | ----------------------- | -------------------------- |
| DM-001     | 小规模数据迁移（<10K）  | 迁移成功，数据完整         |
| DM-002     | 大规模数据迁移（>100K） | 迁移成功，无死循环         |
| DM-003     | 稀疏向量迁移            | 稀疏向量格式正确转换       |
| DM-004     | 数据类型兼容性          | 所有支持的数据类型正确迁移 |
| DM-005     | 迁移过程日志            | 迁移进度和状态正确记录     |

### 5.3 索引迁移功能测试

| 测试用例ID | 测试场景         | 预期结果                       |
| ---------- | ---------------- | ------------------------------ |
| IM-001     | IVF_FLAT索引迁移 | 索引正确创建，参数正确迁移     |
| IM-002     | HNSW索引迁移     | 索引正确创建，参数正确迁移     |
| IM-004     | 索引迁移开关     | config.ini配置正确控制索引迁移 |
| IM-005     | 索引迁移失败处理 | 迁移失败不影响数据迁移功能     |

### 5.4 数据一致性测试

| 测试用例ID | 测试场景       | 预期结果                   |
| ---------- | -------------- | -------------------------- |
| DC-001     | 标量数据一致性 | 迁移前后标量数据完全一致   |
| DC-002     | 稠密向量一致性 | L2距离误差率小于设定阈值   |
| DC-003     | 稀疏向量一致性 | 稀疏向量内容和维度完全一致 |

### 5.5 DQL功能测试

| 测试用例ID | 测试场景     | 预期结果                      |
| ---------- | ------------ | ----------------------------- |
| DQL-001    | 基本检索查询 | 迁移前后检索结果一致          |
| DQL-002    | 相似度搜索   | Top-K结果召回率和精度符合要求 |

### 5.6 性能测试

| 测试用例ID | 测试场景       | 性能指标             |
| ---------- | -------------- | -------------------- |
| PT-001     | 迁移吞吐量测试 | 单位时间内迁移的行数 |

## 6. 测试数据设计

### 6.1 测试数据类型
- **标量数据**：整数、浮点数、字符串、布尔值、空值
- **稠密向量**：768维BERT嵌入向量
- **稀疏向量**：BM25生成的(index: value)字典

### 6.2 测试数据规模
- 小规模：1,000条记录
- 中规模：10,000条记录  
- 大规模：100,000条记录
- 超大规模：1,000,000条记录

## 7. 测试执行计划

### 7.1 测试工具
- **数据生成**：编写生成脚本
- **报告生成**：Typora等markdown编写、PDF生成工具
- **监控工具**：系统资源监控工具

### 7.2 测试阶段
1. **单元测试阶段**：验证各个功能模块的正确性
2. **集成测试阶段**：测试模块间协作和接口
3. **系统测试阶段**：端到端功能验证
4. **性能测试阶段**：性能基准测试
5. **验收测试阶段**：最终验证和报告
