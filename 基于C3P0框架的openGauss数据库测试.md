![avatar](../../images/openGauss.png)

版权所有 © 2024  openGauss社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[*https://creativecommons.org/licenses/by-sa/4.0/*](https://creativecommons.org/licenses/by-sa/4.0/) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[*https://creativecommons.org/licenses/by-sa/4.0/legalcode*](https://creativecommons.org/licenses/by-sa/4.0/legalcode)。

修订记录

| 日期      | 修订版本 | 修改描述                        | 作者 |
| --------- | -------- | ------------------------------- | ---- |
| 2024.9.30 | 1.0      | openGauss对C3P0框架的兼容性测试 | 吕洵 |

[TOC]

**关键词**：

C3P0框架，openGauss数据库，兼容性测试，SQL操作，事务管理

**Abstract 摘要**：

对C3P0框架与openGauss数据库的兼容性进行了全面测试，验证了C3P0框架在不同驱动程序（MySQL和openGauss驱动）下与openGauss数据库的连接池管理、事务管理、SQL操作、存储过程等功能的兼容性。测试结果显示，C3P0框架与openGauss数据库之间的兼容性总体较好，但在部分SQL语法和操作上存在一些差异，相关问题已记录并进行了处理。

**缩略语清单： **

| 缩略语 | 英文全名                   | 中文解释       |
| ------ | -------------------------- | -------------- |
| C3P0   | C3P0 Connection Pool       | C3P0连接池     |
| SQL    | Structured Query Language  | 结构化查询语言 |
| DDL    | Data Definition Language   | 数据定义语言   |
| DML    | Data Manipulation Language | 数据操作语言   |
| DCL    | Data Control Language      | 数据控制语言   |

***


# 1 概述

本报告是针对C3P0框架与openGauss数据库兼容性测试活动的总结，测试对象为C3P0框架与openGauss数据库的交互，测试版本为openGauss数据库5.0.1与C3P0框架0.9.5.5。

# 2 测试版本说明

## 2.1 测试版本信息

###   2.1.1 被测版本

| 版本名称  | 软件包名称       | 测试起始时间 | 测试结束时间 | 测试人员 |
| --------- | ---------------- | ------------ | ------------ | -------- |
| C3P0      | C3P0-0.9.5.5.jar | 2024-07-01   | 2024-09-20   | 吕洵     |
| openGauss | openGauss-5.0.1  | 2024-07-01   | 2024-09-20   | 吕洵     |

###  2.1.2 配套测试的版本

| 版本名称 | 配套版本             | 版本说明                                                |
| -------- | -------------------- | ------------------------------------------------------- |
| MySQL    | mysql-connector-java | MySQL驱动兼容测试:MySQL 8.4 mysql-connector-java 8.0.33 |

## 2.2 测试环境描述

###  2.2.1 环境硬件信息

| 环境信息 | 硬件配置信息                                                 | 备注              |
| -------- | ------------------------------------------------------------ | ----------------- |
| 服务器   | CPU：AMD Ryzen 7 5800H with Radeon Graphics  <br />内存：16.0 GB<br />硬盘：1T<br />OS：Windows 11<br />网卡：Intel PRO | MySQL测试环境     |
| 虚拟机   | CPU：Intel Xeon Processor 4核  <br />内存：4096 MB<br />硬盘：20GB<br />OS：openEuler-22.03-LTS-SP4-everything-x86_64<br /> | OpenGauss测试环境 |

### 2.2.2 虚拟化平台

| 虚拟化平台 | 版本说明 |
| ---------- | -------- |
| VirtualBox | 6.1.22   |

### 2.2.3 OS版本

| 操作系统  | OS版本 | 版本说明                             |
| --------- | ------ | ------------------------------------ |
| openEuler | 22.03  | openEuler 22.03 (LTS)，x86-64版本ISO |

# 3 版本概要测试结论、关键风险和规避措施

## 3.1 测试结论总结

本测试共设计35个测试用例，主要包括连接池管理、事务管理、SQL查询、存储过程调用等方面。测试结果表明，在不同驱动下，C3P0框架与openGauss数据库的兼容性较好，所有关键功能均通过测试。

| 测试活动 | 活动评价                     |
| :------- | :--------------------------- |
| 特性测试 | 兼容性语法评估功能验证，通过 |
| 资料测试 | 工具描述及使用资料验证，通过 |

## 3.2 约束说明

- 该功能在openGauss的A兼容模式下使用。
- 在执行复杂事务和存储过程以及触发器时，openGauss部分SQL语法与MySQL数据库存在差异，需要特别注意。

## 3.3 关键风险和规避措施

无

# 4 版本详细测试结论

## 4.1 特性测试结论

###   4.1.1 新需求质量评价

| 特性                     | 特性价值评估                                                 | 应用说明及关键约束假设依赖                                   | 关键遗留事项如缺陷等                       | 测试整体覆盖情况                             | 特性质量评估                | 主要风险                                                     |
| ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------ | -------------------------------------------- | --------------------------- | ------------------------------------------------------------ |
| C3P0连接池管理           | C3P0框架满足在连接池管理上的稳定性和高性能，提升了用户体验。 | 测试需验证连接池在不同配置下的稳定性和性能。                 | 无                                         | 测试需验证连接池在不同配置下的稳定性和性能。 | <font color=green>▮</font>  | 可能存在连接数量限制或性能瓶颈,无法连上超级用户              |
| 事务管理                 | C3P0框架满足在事务处理上的兼容性，提升了数据一致性和完整性。 | 测试不同事务隔离级别的支持情况，以及在异常情况下的回滚机制。 | 无                                         | 覆盖不同级别事务的开启、提交和回滚操作       | <font color=green>▮</font>  |                                                              |
| SQL查询操作              | C3P0框架支持对DML操作及复杂查询的，确保了系统查询能力和性能。 | 测试需覆盖基本DML操作和复杂查询场景，包括嵌套查询和多表联查  | 无                                         | 覆盖基本DML和复杂查询的执行                  | <font color=green>▮</font>  | 数据库默认返回结果的顺序并不保证按照插入顺序                 |
| DDL操作                  | C3P0框架能够正确执行DDL操作                                  | 测试需验证创建、修改和删除数据库对象的正确性及其对系统的影响 | 部分DDL操作可能在不同驱动下执行语法不同    | 覆盖创建、修改和删除数据库对象               | <font color=green>▮</font>  |                                                              |
| 用户权限管理和角色分配   | C3P0框架在openGauss数据库上具有安全控制功能，提升了系统安全性 | 测试需覆盖`GRANT`和`REVOKE`操作，以及角色的创建和管理。      | 权限撤销可能在某些场景下失败               | 覆盖用户权限和角色管理的所有基本操作         | <font color=yellow>▲</font> | OpenGauss中并没有类似`CASCADE`的方式直接删除角色和所有依赖，只可以逐步解除依赖关系 |
| 聚合函数和窗口函数       | C3P0框架支持聚合函数和窗口函数，确保了数据分析能力。         | 测试需覆盖`COUNT`、`SUM`、`AVG`等聚合函数以及窗口函数的使用。 | 无                                         | 覆盖常用聚合和窗口函数的执行                 | <font color=green>▮</font>  |                                                              |
| 存储过程的定义与调用     | C3P0框架能够正确处理存储过程中的逻辑，提升了业务处理效率。   | 测试需验证存储过程的定义、调用和结果返回。                   | 无                                         | 覆盖存储过程的所有功能                       | <font color=green>▮</font>  | 语法与MySQL有区别                                            |
| 分区表的创建与管理       | C3P0框架支持分区表操作，提升数据查询与管理效率。             | 测试需覆盖分区表的创建、查询和数据插入操作。                 | 某些查询可能无法充分利用分区的优势         | 覆盖分区表的所有基本操作                     | <font color=green>▮</font>  | 分区管理的不当可能影响性能                                   |
| 创建和管理触发器         | 触发器在数据操作中可以自动执行功能，提升了数据一致性与完整性。 | 测试需覆盖`CREATE TRIGGER`的各种场景，包括插入、更新和删除操作 | 触发器需要建立在函数上                     | 覆盖触发器的创建、更新和删除                 | <font color=green>▮</font>  | openGauss建立触发器前需要先创建函数                          |
| 用户定义函数的创建与调用 | 数据库具有自定义函数的功能和性能。                           | 测试需覆盖标量函数和表值函数的创建与调用场景。               | 无                                         | 覆盖所有类型的自定义函数                     | <font color=green>▮</font>  |                                                              |
| CTE的使用                | 在复杂查询中的应用CTE，提升查询的可读性与效率。              | 测试需覆盖`WITH`子句的使用，包括递归查询和分层查询           | 无                                         | 覆盖所有复杂查询场景                         | <font color=green>▮</font>  | 查询效率风险                                                 |
| JSON和XML数据操作        | 系统支持对JSON和XML数据，提升数据存储和查询灵活性。          | 测试需覆盖JSON和XML数据的存储、查询和处理操作。              | 无                                         | 覆盖JSON和XML的所有操作                      | <font color=green>▮</font>  |                                                              |
| 外部表和数据导入/导出    | 数据库支持数据导入和导出                                     | 测试需覆盖`COPY`命令的使用及外部表的创建与查询               | 数据导入或导出时路径权限以及外部表访问权限 | 覆盖外部表的所有操作                         | <font color=yellow>▲</font> | 数据权限风险                                                 |

*特性质量评估说明*：

<font color=red><font color=red>●</font></font>： *表示特性不稳定，风险高*

<font color=yellow><font color=yellow>▲</font></font>： *表示特性基本可用，遗留少量问题*

<font color=green>▮</font>： *表示特性质量良好*

## 4.2 产品质量属性目标(DFX)测试结论

###  4.2.1 性能测试结论

无

###  4.2.2 可靠性测试结论

无

###  4.2.3 安全&隐私保护测试结论

无

### 4.2.4 可服务性测试结论

无

### 4.2.5 生命周期管理测试结论

无

### 4.2.6 韧性测试结论

无

###  4.2.7 兼容性测试结论

新增特性基本不影响已有功能

###  4.2.8 升级测试结论

无

## 4.3 资料测试结论



| 序号 | 测试章节                  | 测试结论                       |
| ---- | ------------------------- | ------------------------------ |
| 1    | SQL参考>SQL语言结构和语法 | 描述和需求相符，示例完整可执行 |
| 2    | 基于JDBC开发>连接数据库   | 描述和需求相符，示例完整可执行 |

# 5 测试对象质量评估

##  5.1 覆盖率分析

需求覆盖情况整体良好，覆盖了正常用户操作场景、数据查询场景、数据导入场景，但部分关键场景和代码仍有提升空间。在后续测试中，针对未覆盖的边界情况、异常处理和多样化数据格式进行深入测试，以进一步提高产品质量和稳定性。

##  5.2 缺陷统计和分析

###   5.2.1 缺陷统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 1        | 0    | 1    | 0    | 0      |
| 百分比 | 100%     | 0%   | 100% | 0%   | 0%     |

###   5.2.2 缺陷列表

| 问题单号 | 问题描述                       | 问题级别 | 当前状态 |
| -------- | ------------------------------ | -------- | -------- |
| 1        | c3p0无法连接不上数据库超级用户 | 主要     | 未解决   |

# 6 测试过程评估

##  6.1 测试策略回顾

*回顾本阶段的测试策略，建议以表格的方式检查测试策略规定的活动是否都已经落实。*

| 编号 | 特性       | 验证策略                                                     | 是否按照测试策略执行 |
| ---- | ---------- | ------------------------------------------------------------ | -------------------- |
| 1    | 功能测试   | 功能测试与需求相符，对于边界值等异常情况给出合理报错，执行结果符合预期 | YES                  |
| 2    | 资料测试   | 资料描述与需求基本相符，在涉及游标的相关章节添加相关语法以及说明 | YES                  |
| 3    | 兼容性测试 | 验证新增特性是否影响已有功能                                 | YES                  |

##  6.2 测试设计评估

| 编号 | 测试点修改说明 | 修改原因 | 是否影响测试质量 |
| ---- | -------------- | -------- | ---------------- |
| NA   |                |          |                  |

##  6.3 测试执行评估

###  6.3.1 测试执行统计数据

| 版本名称        | 工作量投入(人天) | 测试用例数 | 用例执行数 | 发现缺陷数 | 缺陷密度 |
| --------------- | ---------------- | ---------- | ---------- | ---------- | -------- |
| openGauss 5.0.1 | 30               | 35         | 35         |            |          |

###  6.3.2 测试用例执行结果统计数据

*对本次测试用例执行结果统计，其中的字段可根据实际情况进行设计和裁剪。对于Failed，Blocked，Unavailable的测试用例项不为0，须给出说明，并明确相应的后续计划（如：对于物料问题导致未执行用例，则需明确相应的物料计划；对于Blocked用例，需明确问题解决与相应版本的测试时间等）。对于最后一轮测试，要给出相应的规避措施。*

| 总测试用例数 | 实际测试的用例数 | Passed | Failed | Blocked | Unavailable | 执行率 | 执行通过率 |
| ------------ | ---------------- | ------ | ------ | ------- | ----------- | ------ | ---------- |
| 35           | 35               | 0      | 0      | 0       | 0           | 100%   | 100%       |



# 7 附件

##  7.1 附件1：遗留问题列表

| 序号 | 问题单号 | 问题描述                       | 分类 | 问题级别 | 问题分析与影响 | 规避措施               |
| ---- | -------- | ------------------------------ | ---- | -------- | -------------- | ---------------------- |
| 1    | 1        | c3p0无法连接不上数据库超级用户 |      | 主要     |                | 新建用户并授予相关权限 |

##  7.2 附件2：特性相关PR

测试设计文档:

[开源之夏-基于C3P0框架的openGauss数据库测试设计报告 · 6e0cd18 · hydrogenair/examples - Gitee.com](https://gitee.com/hydrogenair/examples/commit/6e0cd184f42d9dc4a14a4d45a6b01e9710bd105a)

源代码PR：

[开源之夏-基于C3P0框架的openGauss、MySQL数据库测试代码 · 89d80a4 · hydrogenair/examples - Gitee.com](https://gitee.com/hydrogenair/examples/commit/89d80a4a9760cd52d694c34ad25ab661d516bfda)
